{% extends "base.html" %}

{% block title %}GEP - ì†í•´ë³´í—˜ì¤‘ê°œì‚¬ ì‹œí—˜ ëŒ€ë¹„{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Hero Section -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">
            ì†í•´ë³´í—˜ì¤‘ê°œì‚¬ ì‹œí—˜ ëŒ€ë¹„
        </h1>
        <p class="text-xl text-gray-600 mb-8">
            ê³¼í•™ì  í•™ìŠµ ì´ë¡ ê³¼ ê¸°ì¶œë¬¸ì œ ê¶Œìœ„ì„±ì„ ê²°í•©í•œ ì°¨ì„¸ëŒ€ í•™ìŠµ í”Œë«í¼
        </p>
        
        <!-- ê´€ë¦¬ì ë„êµ¬ (ìƒë‹¨ ë¹¨ê°„ë°•ìŠ¤ ì˜ì—­) -->
        <div class="mb-8 p-6 bg-red-50 border-2 border-red-200 rounded-lg">
            <h3 class="text-lg font-semibold text-red-800 mb-3">ğŸ”§ ê´€ë¦¬ì ë„êµ¬</h3>
            <div class="flex flex-wrap gap-4 justify-center">
                <a href="/qgenerator" class="inline-flex items-center px-6 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors duration-200 shadow-lg">
                    <i class="fas fa-cogs mr-2"></i>
                    QGENERATOR - ì§„ìœ„í˜• ë¬¸ì œ ìƒì„±ê¸°
                </a>
                <a href="/admin/qmanager" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors duration-200 shadow-lg">
                    <i class="fas fa-tasks mr-2"></i>
                    QMANAGER - ì§„ìœ„í˜• ë¬¸ì œ ê´€ë¦¬
                </a>
            </div>
            <p class="text-sm text-red-600 mt-2">ê¸°ì¶œë¬¸ì œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì§„ìœ„í˜• ë¬¸ì œë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê´€ë¦¬ì ë„êµ¬ì…ë‹ˆë‹¤.</p>
        </div>
        
        <!-- Service Level Primary Actions as Large Buttons -->
        <div class="grid md:grid-cols-3 gap-6 mb-10">
            <div class="service-btn service-btn-free" id="freeServiceBtn">
                <h3 class="service-btn-title">ë¬´ë£Œ ì„œë¹„ìŠ¤ ë°”ë¡œ ì‹œì‘</h3>
                <p class="service-btn-description">ê¸°ì¶œ íšŒì°¨ë³„ í•™ìŠµ</p>
                <ul class="service-btn-features">
                    <li>â€¢ 20íšŒ~30íšŒ ê¸°ì¶œë¬¸ì œ ìˆœì°¨ í•™ìŠµ</li>
                    <li>â€¢ ê¸°ë³¸ í†µê³„ ì œê³µ</li>
                    <li>â€¢ ì´ì–´í’€ê¸° ê¸°ëŠ¥</li>
                </ul>
            </div>
            <div class="service-btn service-btn-basic">
                <h3 class="service-btn-title">ê¸°ë³¸ ì„œë¹„ìŠ¤</h3>
                <p class="service-btn-description">ê³¼ëª©ë³„ í•„í„°ë§ í•™ìŠµ</p>
                <ul class="service-btn-features">
                    <li>â€¢ 12ê°œ ê³¼ëª©ë³„ í•„í„°ë§</li>
                    <li>â€¢ ìƒì„¸ í†µê³„ ë¶„ì„</li>
                    <li>â€¢ í‹€ë¦°ë¬¸ì œ í•™ìŠµ</li>
                </ul>
                <span class="service-btn-status">ì¤€ë¹„ì¤‘</span>
            </div>
            <div class="service-btn service-btn-premium">
                <h3 class="service-btn-title">ê³ ê¸‰ ì„œë¹„ìŠ¤</h3>
                <p class="service-btn-description">ì¢…í•© í•™ìŠµ ê²½í—˜</p>
                <ul class="service-btn-features">
                    <li>â€¢ ê°ê´€ì‹ ë¬¸ì œ ì œê³µ</li>
                    <li>â€¢ ë¯¸ë‹ˆëª¨ì˜ê³ ì‚¬</li>
                    <li>â€¢ ê³ ê¸‰ í†µê³„ ë¶„ì„</li>
                </ul>
                <span class="service-btn-status">ì¤€ë¹„ì¤‘</span>
            </div>
        </div>

        <!-- íšŒì°¨ ì„ íƒ ì˜ì—­ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
        <div id="sessionSelectionArea" class="hidden mt-8">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">í•™ìŠµí•  íšŒì°¨ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
            <div class="grid grid-cols-5 md:grid-cols-11 gap-3 mb-6">
                <button class="session-select-btn" data-session="20">20íšŒ</button>
                <button class="session-select-btn" data-session="21">21íšŒ</button>
                <button class="session-select-btn" data-session="22">22íšŒ</button>
                <button class="session-select-btn" data-session="23">23íšŒ</button>
                <button class="session-select-btn" data-session="24">24íšŒ</button>
                <button class="session-select-btn" data-session="25">25íšŒ</button>
                <button class="session-select-btn" data-session="26">26íšŒ</button>
                <button class="session-select-btn" data-session="27">27íšŒ</button>
                <button class="session-select-btn" data-session="28">28íšŒ</button>
                <button class="session-select-btn" data-session="29">29íšŒ</button>
                <button class="session-select-btn" data-session="30">30íšŒ</button>
            </div>
            <div class="text-center">
                <button id="startLearningBtn" class="gep-btn-primary gep-btn-lg" disabled>
                    <i class="fas fa-play mr-2"></i>
                    ì„ íƒí•œ íšŒì°¨ë¡œ í•™ìŠµ ì‹œì‘
                </button>
            </div>
        </div>
    </div>
    
    <!-- Features Section -->
    <div class="grid md:grid-cols-2 gap-8 mt-12">
        <div class="card">
            <h3 class="text-xl font-semibold mb-4">ê³¼í•™ì  í•™ìŠµ ì´ë¡ </h3>
            <p class="text-gray-600">
                ìµœì‹  êµìœ¡í•™ ì—°êµ¬ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ íš¨ìœ¨ì ì¸ í•™ìŠµ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.
                ê°œì¸ë³„ í•™ìŠµ íŒ¨í„´ ë¶„ì„ì„ í†µí•´ ë§ì¶¤í˜• í•™ìŠµ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.
            </p>
        </div>
        
        <div class="card">
            <h3 class="text-xl font-semibold mb-4">ê¸°ì¶œë¬¸ì œ ê¶Œìœ„ì„±</h3>
            <p class="text-gray-600">
                ì‹¤ì œ ì‹œí—˜ì—ì„œ ì¶œì œëœ ê¸°ì¶œë¬¸ì œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì •í™•í•œ í•™ìŠµ ìë£Œë¥¼ ì œê³µí•©ë‹ˆë‹¤.
                ë¬¸ì œì˜ ë‚œì´ë„ì™€ ì¶œì œ ë¹ˆë„ë¥¼ ë¶„ì„í•˜ì—¬ íš¨ìœ¨ì ì¸ í•™ìŠµì„ ì§€ì›í•©ë‹ˆë‹¤.
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// ìƒˆë¡œìš´ ëŒ€ë¬¸ UI ê´€ë¦¬ ì‹œìŠ¤í…œ
class MainPageManager {
    constructor() {
        this.selectedSession = null;
        this.sessionProgress = this.loadSessionProgress();
        this.initialize();
    }

    initialize() {
        // ë¬´ë£Œ ì„œë¹„ìŠ¤ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('freeServiceBtn').addEventListener('click', () => {
            this.showSessionSelection();
        });

        // íšŒì°¨ ì„ íƒ ë²„íŠ¼ë“¤ ì´ë²¤íŠ¸
        document.querySelectorAll('.session-select-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                this.selectSession(btn.dataset.session);
            });
        });

        // í•™ìŠµ ì‹œì‘ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('startLearningBtn').addEventListener('click', () => {
            this.startLearning();
        });

        // ì´ˆê¸° íšŒì°¨ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        this.updateSessionButtons();
    }

    showSessionSelection() {
        const sessionArea = document.getElementById('sessionSelectionArea');
        sessionArea.classList.remove('hidden');
        sessionArea.scrollIntoView({ behavior: 'smooth' });
    }

    selectSession(sessionNumber) {
        this.selectedSession = sessionNumber;
        
        // ëª¨ë“  ë²„íŠ¼ì—ì„œ ì„ íƒ ìƒíƒœ ì œê±°
        document.querySelectorAll('.session-select-btn').forEach(btn => {
            btn.classList.remove('selected');
        });
        
        // ì„ íƒëœ ë²„íŠ¼ì— ì„ íƒ ìƒíƒœ ì¶”ê°€
        const selectedBtn = document.querySelector(`[data-session="${sessionNumber}"]`);
        if (selectedBtn) {
            selectedBtn.classList.add('selected');
        }
        
        // í•™ìŠµ ì‹œì‘ ë²„íŠ¼ í™œì„±í™”
        document.getElementById('startLearningBtn').disabled = false;
        
        // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        this.updateSessionButtons();
    }

    updateSessionButtons() {
        document.querySelectorAll('.session-select-btn').forEach(btn => {
            const sessionNumber = btn.dataset.session;
            const progress = this.sessionProgress[sessionNumber] || 0;
            const totalQuestions = this.getTotalQuestions(sessionNumber);
            
            if (progress > 0) {
                btn.textContent = `${sessionNumber}íšŒ (${progress}/${totalQuestions})`;
                btn.classList.add('has-progress');
            } else {
                btn.textContent = `${sessionNumber}íšŒ`;
                btn.classList.remove('has-progress');
            }
        });
    }

    getTotalQuestions(sessionNumber) {
        const sessionNum = parseInt(sessionNumber);
        if (sessionNum === 22) return 159;
        if (sessionNum <= 22) return 160;
        return 120;
    }

    startLearning() {
        if (this.selectedSession) {
            // ì„ íƒëœ íšŒì°¨ ì •ë³´ë¥¼ localStorageì— ì €ì¥
            localStorage.setItem('selected_session', this.selectedSession);
            // ë°”ë¡œ ë¬¸ì œí’€ì´ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ë„ë¡ í”Œë˜ê·¸ ì¶”ê°€
            localStorage.setItem('skip_start_screen', 'true');
            // í•™ìŠµ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = '/learning';
        }
    }

    loadSessionProgress() {
        try {
            const results = JSON.parse(localStorage.getItem('gep_quiz_results') || '[]');
            const progress = {};
            
            results.forEach(result => {
                if (result.session) {
                    progress[result.session] = (progress[result.session] || 0) + result.summary.total;
                }
            });
            
            return progress;
        } catch (error) {
            console.error('ì§„í–‰ ìƒí™© ë¡œë“œ ì‹¤íŒ¨:', error);
            return {};
        }
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    // ê¸°ì¡´ ì‚¬ìš©ì ìƒíƒœ í™•ì¸ ì½”ë“œ
    const userPhone = localStorage.getItem('user_phone');
    const serviceLevel = localStorage.getItem('service_level') || 'free';
    
    if (userPhone) {
        // ë¡œê·¸ì¸ëœ ì‚¬ìš©ì
        document.getElementById('user-phone').textContent = userPhone;
        document.getElementById('logout-btn').classList.remove('hidden');
        document.getElementById('service-level').textContent = 
            serviceLevel === 'free' ? 'ë¬´ë£Œ' : 
            serviceLevel === 'basic' ? 'ê¸°ë³¸' : 'ê³ ê¸‰';
    }

    // ìƒˆë¡œìš´ ëŒ€ë¬¸ ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
    window.mainPageManager = new MainPageManager();
});
</script>
{% endblock %}
