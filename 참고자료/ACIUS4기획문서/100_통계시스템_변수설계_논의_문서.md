# 100_통계시스템_변수설계_논의_문서.md

## 📋 **문서 개요**
- **작성일**: 2025년 8월 14일
- **문서 번호**: 100
- **주제**: 통계시스템 변수 설계 논의 및 해결방안
- **상태**: 논의 진행 중

---

## 🎯 **현재 상황 분석**

### **1. 문제 상황**
- **이어풀기 카운터**: 45개 문제 (정상 작동)
- **통계 카운터**: 11개 문제 (비정상)
- **차이**: 34개 문제 누락
- **원인**: 새 통계 함수가 기존 데이터를 무시하고 새로 시작

### **2. 데이터 불일치 현상**
```
기본학습 이어풀기: 45번 문제 위치
기본학습 상단 박스: 11문제 표시
대문 총 풀이 문제: 11문제 표시
```

### **3. 시스템 구조 현황**
- **이어풀기 시스템**: 독립적 진행상황 관리 (정상)
- **통계 시스템**: 누적 집계 관리 (문제 발생)
- **데이터 저장**: LocalStorage 기반

---

## 🔍 **핵심 문제점**

### **1. 변수 설계의 근본적 문제**
- **이어풀기와 통계의 독립성**: 각각 다른 변수 사용
- **데이터 동기화 부재**: 두 시스템 간 연동 로직 없음
- **기존 데이터 무시**: 새 함수가 과거 기록을 덮어씀

### **2. 현재 변수 구조**
```javascript
// 이어풀기 (독립적)
aicu_quiz_progress: { currentQuestionIndex: 45 }

// 통계 (집계)  
aicu_statistics: { total_questions_attempted: 11 }
```

### **3. 논리적 모순**
- 등록 시점부터의 누적 통계 원칙 위반
- 이어풀기와 통계의 불일치
- 사용자 경험 혼란 초래

---

## 🛠️ **해결방안 논의**

### **방안 A: 별도 변수 유지 (현재 구조 개선)**

#### **개념**
- 이어풀기와 통계를 독립적으로 유지
- 데이터 동기화 로직 강화
- 기존 구조 최소 변경

#### **구현 방법**
```javascript
// 1. 임시 조정: 통계를 45로 맞추기
aicu_statistics.total_questions_attempted = 45;

// 2. 자동 동기화 로직 추가
updateStatistics() {
    // 기존 데이터 보호
    if (existing_total > new_total) {
        stats = existing_data;
    }
    // 새 데이터 추가
    stats.total_questions_attempted += 1;
}
```

#### **장점**
- 기존 구조 유지
- 안정성 높음
- 빠른 해결 가능

#### **단점**
- 복잡한 동기화 로직 필요
- 향후 유지보수 부담
- 데이터 불일치 위험 지속

---

### **방안 B: 통합 변수 구조 (근본적 해결)**

#### **개념**
- 이어풀기와 통계를 하나의 통합된 구조로 관리
- 데이터 일관성 보장
- 단순한 관리 로직

#### **구현 방법**
```javascript
// 통합된 통계 구조
aicu_statistics: {
    // 이어풀기 정보
    basic_learning_progress: 45,    // 기본학습 이어풀기
    category_learning_progress: 0,  // 대분류 이어풀기
    
    // 통계 정보
    total_questions_attempted: 45,  // 자동 계산 (A + B)
    total_correct_answers: X,
    accuracy_rate: Y,
    
    // 일별 진행상황
    daily_progress: {
        "2025-08-14": { 
            basic_attempted: 45,    // 오늘 기본학습
            category_attempted: 0,  // 오늘 대분류
            total_attempted: 45     // 오늘 전체
        }
    }
}
```

#### **장점**
- 데이터 일관성 보장
- 단순한 관리 로직
- 향후 확장성 우수

#### **단점**
- 기존 구조 대폭 변경 필요
- 개발 시간 소요
- 테스트 범위 확대

---

## 📊 **화면별 표시 로직 설계**

### **1. 대문 (홈페이지)**
```
총 풀이 문제: C (A + B) - 등록 시점부터 누적
오늘 풀이 문제: today_total - 오늘만의 합계
```

### **2. 기본학습 상단 박스**
```
총 풀이 문제: A - 기본학습만의 누적
오늘 풀이 문제: today_A - 오늘 기본학습만
```

### **3. 대분류학습 상단 박스**
```
총 풀이 문제: B - 대분류만의 누적
오늘 풀이 문제: today_B - 오늘 대분류만
```

---

## ⏰ **시간별 데이터 흐름 예시**

### **DAY 1 (등록일)**
```
기본학습: 10문제 풀이
→ 이어풀기: A = 10
→ 통계: C = 10, today_A = 10
→ 화면 표시: 기본학습 10개, 대문 총 10개
```

### **DAY 2**
```
기본학습: 5문제 추가 풀이
대분류: 3문제 풀이
→ 이어풀기: A = 15, B = 3
→ 통계: C = 18, today_A = 5, today_B = 3
→ 화면 표시: 기본학습 15개, 대분류 3개, 대문 총 18개
```

---

## 🚨 **무한 에러 루프 방지 전략**

### **1. 명확한 설계 결정**
- 변수 구조를 명확히 정의
- 데이터 흐름을 문서화
- 테스트 시나리오 준비

### **2. 단계별 접근**
- 한 번에 하나의 변경만 적용
- 각 단계별 검증 필수
- 롤백 계획 수립

### **3. 데이터 보호**
- 기존 데이터 백업
- 안전한 마이그레이션
- 검증 로직 강화

---

## 🤝 **팀 의견 수렴 필요사항**

### **노팀장 (Technical Advisor) 검토 요청사항**
1. **기술적 안정성**: 어떤 방안이 더 안정적인가?
2. **확장성**: 향후 기능 추가 시 어떤 방안이 유리한가?
3. **성능**: 각 방안의 성능 차이는?
4. **유지보수**: 장기적 관점에서 어떤 방안이 효율적인가?

### **서대리 (Lead Developer) 검토 요청사항**
1. **구현 복잡도**: 각 방안의 개발 난이도는?
2. **테스트 범위**: 어떤 방안이 테스트하기 쉬운가?
3. **버그 위험**: 각 방안의 잠재적 문제점은?
4. **개발 시간**: 각 방안의 예상 소요 시간은?

### **나실장 (Project Manager) 검토 요청사항**
1. **비즈니스 영향**: 어떤 방안이 사용자 경험에 유리한가?
2. **일정 관리**: 각 방안의 일정 영향도는?
3. **리스크 관리**: 각 방안의 위험 요소는?
4. **우선순위**: 현재 상황에서 어떤 방안이 최적인가?

---

## 📝 **결론 및 다음 단계**

### **현재 상태**
- 문제 상황 명확히 파악됨
- 두 가지 해결방안 제시됨
- 팀 의견 수렴 필요

### **필요한 결정사항**
1. **변수 구조 선택**: 별도 vs 통합
2. **구현 우선순위**: 단기 vs 장기
3. **개발 일정**: 즉시 vs 단계적
4. **테스트 전략**: 범위와 방법

### **권장사항**
- **단기적**: 방안 A로 즉시 문제 해결
- **장기적**: 방안 B로 근본적 구조 개선
- **안전성**: 데이터 백업 및 단계별 검증 필수

---

## 📋 **체크리스트**

### **결정 전 체크사항**
- [ ] 노팀장 기술적 검토 완료
- [ ] 서대리 구현 가능성 검토 완료  
- [ ] 나실장 비즈니스 영향도 검토 완료
- [ ] 팀 합의 도출 완료
- [ ] 구현 계획 수립 완료

### **구현 전 체크사항**
- [ ] 기존 데이터 백업 완료
- [ ] 테스트 시나리오 준비 완료
- [ ] 롤백 계획 수립 완료
- [ ] 단계별 검증 계획 수립 완료

---

**문서 작성자**: 나실장 (Project Manager)  
**작성일**: 2025년 8월 14일  
**상태**: 팀 검토 대기 중
