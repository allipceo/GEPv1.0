# 서대리 문제로딩 오류 진단 지시문 (app_v2.0 기준)

**작성일**: 2025년 8월 11일 06:31 KST  
**작성자**: 노팀장  
**대상자**: 서대리  
**기준 파일**: app_v2.0.py (기존 app_v1.8_simple.py)  
**진단 목표**: 문제로딩 오류 원인 파악 및 해결  
**고려사항**: 파일명 체계 수정 (V1.0 → V1_0) 영향도 분석  

---

## 🎯 **진단 개요**

### **현재 상황**
- **기준 앱**: app_v2.0.py (정상 작동 확인된 버전)
- **문제 현상**: 문제로딩이 잘 안되고 있음
- **변경사항**: 파일명 체계 수정 (점 제거, 언더스코어 사용)
- **예상 영향**: import 구문 및 경로 문제 가능성

### **진단 전략**
1. **데이터 파일 → 서비스 모듈 → 앱 연결 → 프론트엔드** 순서로 체계적 검증
2. **각 단계별 이상유무 판단**
3. **문제 발견 시 즉시 보고 및 해결방안 제시**

---

## 📋 **1단계: 데이터 파일 무결성 검증**

### **A. 핵심 데이터 파일 확인**

#### **1-A-1: questions.json 파일 검증**
```bash
# 실행 명령
ls -la data/questions.json
wc -l data/questions.json
head -5 data/questions.json
tail -5 data/questions.json
```

**확인 포인트**:
- [ ] 파일 존재 여부 (612KB, 17,378줄)
- [ ] JSON 형식 유효성
- [ ] 789개 문제 데이터 완전성
- [ ] 첫 번째/마지막 문제 정상 표시

**정상 기준**: 612KB, 17,378줄, 유효한 JSON 구조

#### **1-A-2: ins_master_db.csv 원본 검증**
```bash
# 실행 명령
ls -la data/ins_master_db.csv
wc -l data/ins_master_db.csv
head -3 data/ins_master_db.csv
```

**확인 포인트**:
- [ ] 파일 존재 여부 (621KB, 3,995줄)
- [ ] CSV 헤더 정상성
- [ ] 데이터 필드 완전성

**정상 기준**: 621KB, 3,995줄, QCODE,QUESTION,ANSWER 헤더 존재

### **B. 데이터 파일 JSON 구조 검증**

#### **1-B-1: Python으로 JSON 로딩 테스트**
```python
# 실행 코드
import json
import os

try:
    with open('data/questions.json', 'r', encoding='utf-8') as f:
        data = json.load(f)
    print(f"✅ JSON 로딩 성공: {len(data)}개 문제")
    print(f"✅ 첫 번째 문제: {data[0]['qcode'] if data else 'None'}")
    print(f"✅ 데이터 구조: {list(data[0].keys()) if data else 'None'}")
except Exception as e:
    print(f"❌ JSON 로딩 실패: {e}")
```

**확인 포인트**:
- [ ] JSON 로딩 성공/실패
- [ ] 문제 개수 (789개 예상)
- [ ] 필수 필드 존재 (qcode, question, answer, layer1)

---

## 🔧 **2단계: 서비스 모듈 연결 검증**

### **A. 파일명 체계 수정 영향 확인**

#### **2-A-1: 변경된 파일명 현황 확인**
```bash
# 실행 명령
find . -name "*quiz*" -type f | grep -E "\.(py|html)$"
find . -name "*V1[._]0*" -type f
find . -name "*v1[._]0*" -type f
```

**확인 포인트**:
- [ ] quiz_routes_V1.0.py → quiz_routes_v1_0.py 변경 확인
- [ ] quiz_routes.py 메인 파일 존재 확인
- [ ] 기타 V1.0 → v1_0 변경 파일들

#### **2-A-2: import 구문 업데이트 확인**
```bash
# 실행 명령
grep -r "quiz_routes_V1" . --include="*.py" | head -5
grep -r "V1\.0" . --include="*.py" | head -5
grep -r "from routes\.quiz_routes" . --include="*.py"
```

**확인 포인트**:
- [ ] 구식 import 구문 잔존 여부
- [ ] 점(.) 포함 모듈명 사용 잔존
- [ ] app_v2.0.py에서 올바른 import 사용 확인

### **B. 서비스 모듈 import 테스트**

#### **2-B-1: 개별 서비스 모듈 import 테스트**
```python
# 실행 코드
import sys
import os

# 경로 설정 (app_v2.0.py와 동일)
current_dir = os.path.dirname(os.path.abspath(__file__))
parent_dir = os.path.dirname(current_dir)
sys.path.insert(0, parent_dir)

# 각 서비스 모듈 테스트
modules_to_test = [
    'services.quiz_data_service_v1',
    'services.quiz_session_service',
    'services.quiz_answer_service'
]

for module_name in modules_to_test:
    try:
        module = __import__(module_name, fromlist=[''])
        print(f"✅ {module_name} import 성공")
    except ImportError as e:
        print(f"❌ {module_name} import 실패: {e}")
```

**확인 포인트**:
- [ ] quiz_data_service_v1.py import 성공/실패
- [ ] quiz_session_service.py import 성공/실패  
- [ ] quiz_answer_service.py import 성공/실패
- [ ] sys.path 설정 정상 작동

#### **2-B-2: 서비스 함수 호출 테스트**
```python
# 실행 코드 (import 성공한 경우만)
try:
    from services.quiz_data_service_v1 import get_quiz_data_service
    service = get_quiz_data_service()
    questions = service.get_questions_by_category('재산보험')[:3]
    print(f"✅ 문제 로딩 성공: {len(questions)}개")
    for q in questions:
        print(f"   - {q.get('qcode', 'No Code')}: {q.get('question', 'No Question')[:50]}...")
except Exception as e:
    print(f"❌ 서비스 함수 호출 실패: {e}")
```

**확인 포인트**:
- [ ] get_quiz_data_service() 함수 정상 호출
- [ ] 카테고리별 문제 로딩 성공
- [ ] 실제 문제 데이터 반환 확인

---

## 🚀 **3단계: Flask 앱 연결 검증**

### **A. app_v2.0.py 기준 서버 시작 테스트**

#### **3-A-1: 서버 시작 로그 분석**
```bash
# 실행 명령
python app_v2.0.py 2>&1 | tee server_start.log
```

**확인 포인트**:
- [ ] "✅ Week2 퀴즈 API 등록 성공" 메시지 확인
- [ ] import 오류 메시지 없음
- [ ] Flask 서버 정상 시작 (5000번 포트)
- [ ] Blueprint 등록 성공 메시지들

#### **3-A-2: routes/quiz_routes.py Blueprint 확인**
```python
# routes/quiz_routes.py 파일 내용 확인 코드
import os

file_path = 'routes/quiz_routes.py'
if os.path.exists(file_path):
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # Blueprint 정의 확인
    if 'quiz_bp' in content:
        print("✅ quiz_bp Blueprint 정의 확인")
    else:
        print("❌ quiz_bp Blueprint 정의 없음")
    
    # 라우트 정의 개수
    route_count = content.count('@quiz_bp.route')
    print(f"📊 정의된 라우트 수: {route_count}개")
else:
    print("❌ routes/quiz_routes.py 파일 없음")
```

**확인 포인트**:
- [ ] quiz_routes.py 파일 존재
- [ ] quiz_bp Blueprint 정의 확인
- [ ] @quiz_bp.route 라우트 정의 개수 (6개 예상)

### **B. API 엔드포인트 작동 테스트**

#### **3-B-1: 헬스체크 엔드포인트 테스트**
```bash
# 실행 명령 (서버 실행 중일 때)
curl -X GET http://localhost:5000/api/quiz/health
curl -X GET http://localhost:5000/api/quiz/status
```

**확인 포인트**:
- [ ] 200 OK 응답
- [ ] JSON 형태 응답 데이터
- [ ] 에러 메시지 없음

#### **3-B-2: 문제 로딩 API 테스트**
```bash
# 실행 명령
curl -X POST http://localhost:5000/api/quiz/start \
  -H "Content-Type: application/json" \
  -d '{"category":"재산보험", "mode":"basic"}'
```

**확인 포인트**:
- [ ] 문제 데이터 정상 반환
- [ ] 카테고리별 필터링 작동
- [ ] 에러 응답 없음

---

## 🎨 **4단계: 프론트엔드 연결 검증**

### **A. HTML 템플릿 파일 확인**

#### **4-A-1: 학습 페이지 접속 테스트**
```bash
# 브라우저에서 접속 테스트
# http://localhost:5000/basic-learning
# http://localhost:5000/large-category-learning
```

**확인 포인트**:
- [ ] 페이지 정상 로딩
- [ ] JavaScript 에러 없음 (브라우저 콘솔 확인)
- [ ] 문제 영역 표시 정상

#### **4-A-2: JavaScript 문제 로딩 함수 확인**
```javascript
// 브라우저 콘솔에서 실행
console.log('=== 문제 로딩 테스트 ===');

// 카테고리 데이터 로딩 테스트
if (typeof loadCategoryData === 'function') {
    loadCategoryData('재산보험');
    console.log('✅ loadCategoryData 함수 존재');
} else {
    console.log('❌ loadCategoryData 함수 없음');
}

// 전역 변수 확인
setTimeout(() => {
    if (window.currentCategoryData) {
        console.log('✅ 데이터 로딩 성공:', window.currentCategoryData.totalCount, '개 문제');
    } else {
        console.log('❌ 데이터 로딩 실패');
    }
}, 3000);
```

**확인 포인트**:
- [ ] loadCategoryData 함수 정의 확인
- [ ] window.currentCategoryData 설정 확인
- [ ] JavaScript 에러 메시지 없음

---

## 📊 **진단 결과 보고서 양식**

### **각 단계별 체크리스트**

#### **1단계: 데이터 파일 ✅/❌**
```
□ questions.json 파일 존재 및 유효성
□ ins_master_db.csv 파일 존재 및 유효성  
□ JSON 구조 정상성
□ 789개 문제 데이터 완전성
```

#### **2단계: 서비스 모듈 ✅/❌**
```
□ 파일명 체계 수정 완료
□ import 구문 업데이트 완료
□ quiz_data_service_v1.py import 성공
□ 서비스 함수 정상 호출
```

#### **3단계: Flask 앱 연결 ✅/❌**
```
□ app_v2.0.py 서버 정상 시작
□ quiz_routes.py Blueprint 등록 성공
□ API 엔드포인트 응답 정상
□ 문제 로딩 API 정상 작동
```

#### **4단계: 프론트엔드 연결 ✅/❌**
```
□ 학습 페이지 정상 접속
□ JavaScript 함수 정상 정의
□ 브라우저에서 문제 로딩 성공
□ 사용자 인터페이스 정상 작동
```

---

## 🚨 **문제 발견 시 즉시 보고 형식**

### **문제 발견 보고서**
```
=== 문제 발견 보고 ===
발견 시각: 2025년 8월 11일 XX:XX KST
발견 단계: [1단계/2단계/3단계/4단계]
문제 유형: [파일 없음/import 실패/API 오류/기타]

■ 문제 상황:
[구체적인 오류 메시지 또는 현상]

■ 재현 방법:
[문제를 재현할 수 있는 명령어 또는 절차]

■ 예상 원인:
[파일명 변경 영향/경로 문제/코드 오류/기타]

■ 제안 해결책:
[즉시 시도해볼 수 있는 해결 방안]
```

---

## ⚡ **즉시 실행 지시사항**

### **Step 1: 환경 준비 (5분)**
1. 터미널에서 프로젝트 루트 폴더로 이동
2. `ls -la app_v2.0.py` 명령으로 기준 파일 확인
3. `python --version` 으로 Python 환경 확인

### **Step 2: 순차적 진단 (20분)**
1. **1단계부터 순서대로 진행**
2. **각 체크포인트마다 ✅/❌ 기록**
3. **❌ 발견 시 즉시 보고**

### **Step 3: 결과 종합 (5분)**
1. **전체 체크리스트 요약**
2. **핵심 문제점 정리**
3. **해결 우선순위 제시**

---

## 📞 **보고 및 소통**

### **진행 상황 보고**
- **매 단계 완료 시**: "X단계 완료, Y개 문제 발견"
- **문제 발견 시**: 즉시 상세 보고서 작성
- **최종 완료 시**: 종합 진단 결과 및 해결 방안 제시

### **예상 소요 시간**
- **전체 진단**: 30분
- **문제 발견 시 추가**: 10-20분
- **해결 방안 수립**: 10분

**서대리님, 위 지시사항에 따라 체계적으로 문제로딩 오류 원인을 파악해 주세요. 발견되는 모든 이상사항을 즉시 보고하겠습니다.**