# 070_서대리_통계기능정의서.md

## 📊 **AICU S4 통계 기능 정의서 v2.0**

**작성일**: 2025년 8월 11일  
**작성자**: 서대리 (AI Assistant)  
**승인자**: 조대표님  
**기준**: 조대표님 시나리오 기반 + 실제 사용자 경험 중심  
**버전**: V2.0 (실제 사용 시나리오 반영)

---

## 🎯 **통계 기능 핵심 철학**

### **조대표님의 핵심 요구사항**
```
"모든 통계의 출발은 설정 등록일부터 시작
이어풀기가 앱의 가장 기본 모드이며 정확한 데이터 기반
각 학습 모드별 독립적 진행도 추적 + 통합 통계 제공"
```

### **실제 사용 시나리오 분석**
- **Day-1**: 11:00 등록 → 기본학습 1-10번 → 2시간 후 11번부터 이어풀기
- **Day-1**: 12:00 → 기본학습 11-20번 → 대분류 해상보험 1-20번 → 기본학습 21번부터
- **Day-2**: 09:00 → 기본학습 21번부터 (금일 0, 누적 20) → 21-30번 풀이 (금일 10, 누적 30)

---

## 📋 **1순위: 핵심 통계 기능 (즉시 구현)**

### **🏠 대문(홈) 화면 통계**

#### **A. 보유문제수 현황**
```javascript
// 데이터 소스: ins_master_db.csv
// 필터링: "인스교제외" + "보험중개사 시험"
// 표시: "전체 1,370개 문제 보유"
// 업데이트: 앱 시작 시 1회 계산

function calculateQuestionCounts() {
    const csvData = loadCSVData();
    return {
        total: csvData.length,
        인스교재: csvData.filter(row => row.SOURCE?.includes('인스교재')).length,
        중개사시험: csvData.filter(row => row.SOURCE?.includes('중개사시험')).length
    };
}
```

#### **B. 학습진도 현황**
```javascript
// 기준점: 사용자 등록 시점부터 데이터 수집
// 완료문제: 모든 학습 모드 통합 풀이 문제 수
// 전체진도율: 완료문제 ÷ 보유문제수 × 100
// 정답율: 전체 풀이 문제 중 정답 비율

function calculateProgressStats(userId) {
    const userProgress = loadUserProgress(userId);
    const totalQuestions = getTotalQuestionCount();
    
    // 모든 학습 모드 통합 통계
    const totalAttempted = userProgress.basicLearning.cumulative.totalAttempted + 
                          userProgress.largeCategory.cumulative.totalAttempted;
    const totalCorrect = userProgress.basicLearning.cumulative.totalCorrect + 
                        userProgress.largeCategory.cumulative.totalCorrect;
    
    return {
        completedQuestions: totalAttempted,
        progressRate: (totalAttempted / totalQuestions) * 100,
        accuracyRate: totalAttempted > 0 ? (totalCorrect / totalAttempted) * 100 : 0
    };
}
```

#### **C. 금일 학습현황**
```javascript
// 오늘 총 문제수: 모든 학습 모드 통합 당일 풀이 문제 수
// 오늘 정답수: 모든 학습 모드 통합 당일 정답 문제 수
// 오늘 정답율: 당일 통합 정답률

function calculateTodayStats(userId) {
    const today = new Date().toISOString().split('T')[0];
    const userProgress = loadUserProgress(userId);
    
    // 기본학습 금일 통계
    const basicToday = userProgress.basicLearning.daily[today] || {
        attempted: 0, correct: 0, accuracy: 0
    };
    
    // 대분류학습 금일 통계 (모든 카테고리 합산)
    const largeCategoryToday = userProgress.largeCategory.daily[today] || {};
    let largeCategoryTotal = 0;
    let largeCategoryCorrect = 0;
    
    Object.values(largeCategoryToday).forEach(categoryStats => {
        largeCategoryTotal += categoryStats.attempted || 0;
        largeCategoryCorrect += categoryStats.correct || 0;
    });
    
    const totalTodayAttempted = basicToday.attempted + largeCategoryTotal;
    const totalTodayCorrect = basicToday.correct + largeCategoryCorrect;
    
    return {
        todayAttempted: totalTodayAttempted,
        todayCorrect: totalTodayCorrect,
        todayAccuracy: totalTodayAttempted > 0 ? (totalTodayCorrect / totalTodayAttempted) * 100 : 0
    };
}
```

### **📚 기본학습 통계**

#### **D. 이어풀기 중심 2줄 통계 구조**
```javascript
// 핵심: 마지막 풀이 위치 기억 및 이어풀기 지원
// 1줄: 누적현황 (등록일부터 전체)
// 2줄: 금일현황 (오늘만)

function updateBasicLearningStats(userId) {
    const userProgress = loadUserProgress(userId);
    const today = new Date().toISOString().split('T')[0];
    
    // 누적 현황 (등록일부터 전체)
    const cumulative = {
        total: userProgress.basicLearning.cumulative.totalAttempted,
        correct: userProgress.basicLearning.cumulative.totalCorrect,
        accuracy: userProgress.basicLearning.cumulative.accuracy,
        currentIndex: userProgress.basicLearning.currentIndex // 이어풀기용
    };
    
    // 금일 현황 (오늘만)
    const todayStats = userProgress.basicLearning.daily[today] || {
        attempted: 0, correct: 0, accuracy: 0
    };
    
    return { cumulative, today: todayStats };
}

// 이어풀기 시작 위치 계산
function getNextQuestionIndex(userId) {
    const userProgress = loadUserProgress(userId);
    return userProgress.basicLearning.currentIndex + 1; // 마지막 풀이 다음 문제
}
```

### **🎯 대분류학습 통계**

#### **E. 카테고리별 독립 이어풀기**
```javascript
// 각 카테고리별 독립적인 진행도 추적
// 카테고리별 마지막 풀이 위치 기억

function updateLargeCategoryStats(userId, category) {
    const userProgress = loadUserProgress(userId);
    const today = new Date().toISOString().split('T')[0];
    
    // 카테고리별 누적 통계
    const categoryStats = userProgress.largeCategory.categories[category] || {
        attempted: 0, correct: 0, accuracy: 0, currentIndex: 0
    };
    
    // 카테고리별 금일 통계
    const todayStats = userProgress.largeCategory.daily[today]?.[category] || {
        attempted: 0, correct: 0, accuracy: 0
    };
    
    return {
        cumulative: categoryStats,
        today: todayStats,
        nextIndex: categoryStats.currentIndex + 1 // 이어풀기용
    };
}
```

---

## 🔧 **2순위: 데이터 연동 및 관리**

### **데이터 구조 설계 (이어풀기 중심)**
```javascript
// user_progress.json 구조 (이어풀기 지원)
{
    "userId": "user_jo_ceo_default",
    "registeredAt": "2025-08-11T11:00:00Z", // 통계 시작점
    "lastUpdated": "2025-08-11T22:30:00Z",
    
    // 기본학습 통계 (이어풀기 중심)
    "basicLearning": {
        "cumulative": {
            "totalAttempted": 30,        // 누적 풀이 수
            "totalCorrect": 25,          // 누적 정답 수
            "totalWrong": 5,             // 누적 오답 수
            "accuracy": 83.33            // 누적 정답률
        },
        "currentIndex": 30,              // 마지막 풀이 위치 (이어풀기용)
        "daily": {
            "2025-08-11": {
                "attempted": 20,         // 금일 풀이 수
                "correct": 17,           // 금일 정답 수
                "accuracy": 85.0         // 금일 정답률
            }
        },
        "streak": 3                      // 연속 정답
    },
    
    // 대분류학습 통계 (카테고리별 독립)
    "largeCategory": {
        "cumulative": {
            "totalAttempted": 40,        // 전체 카테고리 합산
            "totalCorrect": 32,          // 전체 카테고리 합산
            "accuracy": 80.0             // 전체 카테고리 합산
        },
        "categories": {
            "재산보험": { 
                "attempted": 10, "correct": 8, "accuracy": 80.0, "currentIndex": 10
            },
            "특종보험": { 
                "attempted": 10, "correct": 9, "accuracy": 90.0, "currentIndex": 10
            },
            "배상책임보험": { 
                "attempted": 10, "correct": 7, "accuracy": 70.0, "currentIndex": 10
            },
            "해상보험": { 
                "attempted": 10, "correct": 8, "accuracy": 80.0, "currentIndex": 10
            }
        },
        "daily": {
            "2025-08-11": {
                "재산보험": { "attempted": 5, "correct": 4, "accuracy": 80.0 },
                "특종보험": { "attempted": 5, "correct": 5, "accuracy": 100.0 },
                "배상책임보험": { "attempted": 5, "correct": 3, "accuracy": 60.0 },
                "해상보험": { "attempted": 5, "correct": 4, "accuracy": 80.0 }
            }
        }
    }
}
```

### **실시간 업데이트 시스템 (이어풀기 지원)**
```javascript
// 문제 풀이 시 통계 업데이트 (이어풀기 위치 추적)
async function updateStatisticsAfterAnswer(userId, learningMode, category, isCorrect, questionIndex) {
    const userProgress = loadUserProgress(userId);
    const today = new Date().toISOString().split('T')[0];
    
    // 기본학습 통계 업데이트
    if (learningMode === 'basic') {
        userProgress.basicLearning.cumulative.totalAttempted++;
        if (isCorrect) {
            userProgress.basicLearning.cumulative.totalCorrect++;
            userProgress.basicLearning.streak++;
        } else {
            userProgress.basicLearning.cumulative.totalWrong++;
            userProgress.basicLearning.streak = 0;
        }
        
        // 이어풀기용 현재 위치 업데이트
        userProgress.basicLearning.currentIndex = questionIndex;
        
        // 금일 통계 업데이트
        if (!userProgress.basicLearning.daily[today]) {
            userProgress.basicLearning.daily[today] = {
                attempted: 0, correct: 0, accuracy: 0
            };
        }
        
        userProgress.basicLearning.daily[today].attempted++;
        if (isCorrect) {
            userProgress.basicLearning.daily[today].correct++;
        }
    }
    
    // 대분류학습 통계 업데이트
    if (learningMode === 'large_category' && category) {
        userProgress.largeCategory.cumulative.totalAttempted++;
        if (isCorrect) {
            userProgress.largeCategory.cumulative.totalCorrect++;
        } else {
            userProgress.largeCategory.cumulative.totalWrong++;
        }
        
        // 카테고리별 통계 업데이트
        if (!userProgress.largeCategory.categories[category]) {
            userProgress.largeCategory.categories[category] = {
                attempted: 0, correct: 0, accuracy: 0, currentIndex: 0
            };
        }
        
        userProgress.largeCategory.categories[category].attempted++;
        if (isCorrect) {
            userProgress.largeCategory.categories[category].correct++;
        }
        
        // 이어풀기용 카테고리별 현재 위치 업데이트
        userProgress.largeCategory.categories[category].currentIndex = questionIndex;
        
        // 금일 카테고리별 통계 업데이트
        if (!userProgress.largeCategory.daily[today]) {
            userProgress.largeCategory.daily[today] = {};
        }
        if (!userProgress.largeCategory.daily[today][category]) {
            userProgress.largeCategory.daily[today][category] = {
                attempted: 0, correct: 0, accuracy: 0
            };
        }
        
        userProgress.largeCategory.daily[today][category].attempted++;
        if (isCorrect) {
            userProgress.largeCategory.daily[today][category].correct++;
        }
    }
    
    // 정확도 재계산
    recalculateAccuracy(userProgress);
    
    // 저장
    await saveUserProgress(userId, userProgress);
    
    // UI 업데이트
    updateAllStatisticsDisplays(userId);
}
```

---

## 📈 **3순위: 고급 분석 기능**

### **학습 패턴 분석**
```javascript
// 일별 학습량 추이 (7일간)
function getWeeklyLearningTrend(userId) {
    const userProgress = loadUserProgress(userId);
    const today = new Date();
    const weeklyData = [];
    
    for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const dateKey = date.toISOString().split('T')[0];
        
        // 기본학습 + 대분류학습 통합 일일 통계
        const basicDaily = userProgress.basicLearning.daily[dateKey] || {
            attempted: 0, correct: 0, accuracy: 0
        };
        
        const largeCategoryDaily = userProgress.largeCategory.daily[dateKey] || {};
        let largeCategoryTotal = 0;
        let largeCategoryCorrect = 0;
        
        Object.values(largeCategoryDaily).forEach(categoryStats => {
            largeCategoryTotal += categoryStats.attempted || 0;
            largeCategoryCorrect += categoryStats.correct || 0;
        });
        
        const totalAttempted = basicDaily.attempted + largeCategoryTotal;
        const totalCorrect = basicDaily.correct + largeCategoryCorrect;
        
        weeklyData.push({
            date: dateKey,
            attempted: totalAttempted,
            correct: totalCorrect,
            accuracy: totalAttempted > 0 ? (totalCorrect / totalAttempted) * 100 : 0
        });
    }
    
    return weeklyData;
}

// 취약점 분석 (카테고리별)
function analyzeWeaknesses(userId) {
    const userProgress = loadUserProgress(userId);
    const categories = userProgress.largeCategory.categories;
    
    const weaknesses = Object.entries(categories)
        .filter(([category, stats]) => stats.accuracy < 70)
        .sort((a, b) => a[1].accuracy - b[1].accuracy)
        .map(([category, stats]) => ({
            category,
            accuracy: stats.accuracy,
            attempted: stats.attempted,
            currentIndex: stats.currentIndex
        }));
    
    return weaknesses;
}
```

---

## 🎯 **구현 우선순위 및 일정**

### **Phase 1: 핵심 통계 기능 (3일)**
- **Day 1**: 대문 3개 통계 박스 실시간 연동 (통합 통계)
- **Day 2**: 기본학습 이어풀기 + 2줄 통계 완성
- **Day 3**: 대분류학습 카테고리별 이어풀기 + 통계 완성

### **Phase 2: 데이터 연동 (2일)**
- **Day 4**: user_progress.json 구조 완성 (이어풀기 지원)
- **Day 5**: 실시간 업데이트 시스템 구현 (위치 추적)

### **Phase 3: 고급 기능 (2일)**
- **Day 6**: 학습 패턴 분석 기능
- **Day 7**: 취약점 분석 및 개선 제안

---

## 🔧 **기술 구현 세부사항**

### **파일 구조**
```
data/
├── user_progress.json          # 사용자별 학습 진행도 (이어풀기 지원)
├── ins_master_db.csv          # 문제 데이터베이스
└── questions.json             # 변환된 문제 데이터

static/js/
├── statistics_manager.js      # 통계 관리 모듈
├── data_sync.js              # 데이터 동기화 모듈
├── progress_tracker.js        # 이어풀기 추적 모듈
└── analysis_engine.js        # 분석 엔진

services/
├── statistics_service.py     # 통계 서비스
├── progress_service.py       # 진행도 서비스
└── continuity_service.py     # 이어풀기 서비스
```

### **API 엔드포인트**
```python
# 통계 관련 API
GET /api/statistics/user/{userId}          # 사용자 통계 조회
POST /api/statistics/update               # 통계 업데이트
GET /api/statistics/progress/{userId}     # 진행도 조회
GET /api/statistics/continuity/{userId}   # 이어풀기 위치 조회
GET /api/statistics/analysis/{userId}     # 분석 결과 조회
```

---

## 📊 **성공 지표**

### **기능 완성도**
- ✅ **대문 통계**: 3개 박스 실시간 표시 (통합 통계)
- ✅ **기본학습 통계**: 2줄 구조 완성 + 이어풀기 지원
- ✅ **대분류학습 통계**: 4개 카테고리별 통계 + 이어풀기 지원
- ✅ **데이터 연동**: 실시간 업데이트 + 위치 추적
- ✅ **다중 사용자**: 사용자별 독립 통계

### **성능 지표**
- **응답 시간**: 통계 업데이트 1초 이내
- **데이터 정확성**: 100% 정확한 통계 계산
- **이어풀기 정확성**: 100% 정확한 위치 추적
- **동기화**: 기기 간 실시간 동기화
- **안정성**: 99.9% 가동률

---

## 🎉 **결론 및 기대 효과**

### **사용자 경험 향상**
1. **명확한 학습 현황 파악**: 현재 위치와 목표까지의 거리
2. **이어풀기 지원**: 언제든 중단 후 이어서 학습 가능
3. **개인화된 학습 가이드**: 취약점 기반 맞춤 학습
4. **동기부여**: 시각적 성과 확인으로 학습 의욕 증대

### **비즈니스 가치**
1. **사용자 만족도**: 과학적 학습 방법론 제공
2. **합격률 향상**: 데이터 기반 개선 제안
3. **경쟁력 확보**: 차별화된 학습 분석 기능
4. **사용자 유지**: 이어풀기로 인한 학습 연속성 확보

### **기술적 성과**
1. **확장 가능한 구조**: 새로운 통계 기능 추가 용이
2. **성능 최적화**: 효율적인 데이터 처리
3. **유지보수성**: 모듈화된 구조로 관리 용이
4. **데이터 무결성**: 정확한 진행도 추적

---

**작성자**: 서대리 (AI Assistant)  
**작성일**: 2025년 8월 11일  
**상태**: ✅ 완료  
**다음 단계**: 조대표님 검토 및 승인 후 구현 착수
