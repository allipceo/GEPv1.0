# 문제풀이 기능 분할 개발 계획

**목표**: 시즌1 문제풀이 기능을 분할 개발 원칙에 맞게 재구성  
**기준**: 각 모듈 200줄 이하 + 기존 자산 최대 활용  
**원칙**: Week1 완성 모듈들 활용 + 점진적 개선  

---

## 📊 **문제풀이 기능 분석**

### **시즌1 문제풀이 핵심 기능**
```
✅ 기본학습 (이어풀기/처음풀기/랜덤풀기)
✅ 대분류학습 (재산보험/특종보험/배상책임보험/해상보험)  
✅ 문제 표시 (진위형/선택형)
✅ 답안 처리 (정답 확인/결과 표시)
✅ 진도 관리 (이전/다음 문제)
✅ 저장/복원 (진행 상황 보존)
```

### **기존 자산 현황**
```
modules/quiz_handler.py     (357줄) ✅ 완전 검증됨
modules/stats_handler.py    (460줄) ✅ 완전 검증됨  
modules/data_converter.py   (271줄) ✅ 완전 검증됨
data/questions.json         (789개 문제) ✅ 완전 검증됨
```

---

## 🔧 **분할 개발 구조**

### **Module 1: quiz_data_service.py (150줄)**
**목적**: 문제 데이터 로드 및 관리  
**기존 자산**: `modules/data_converter.py` 활용

```python
class QuizDataService:
    """문제 데이터 전문 관리"""
    
    def __init__(self):
        self.questions_data = None
        self.category_mapping = {
            '재산보험': 'LAYER1_1',
            '특종보험': 'LAYER1_2', 
            '배상책임보험': 'LAYER1_3',
            '해상보험': 'LAYER1_4'
        }
    
    def load_all_questions(self):
        """전체 문제 로드 (기본학습용)"""
        # modules/data_converter.py 활용
        
    def load_category_questions(self, category):
        """카테고리별 문제 로드 (대분류학습용)"""
        # LAYER1 필드 기준 필터링
        
    def get_question_by_index(self, index, mode='basic'):
        """특정 인덱스 문제 반환"""
        
    def get_random_question(self, attempted_questions=[]):
        """랜덤 문제 선택 (중복 제외)"""
        
    def validate_question_data(self, question):
        """문제 데이터 유효성 검증"""
```

### **Module 2: quiz_session_manager.py (180줄)**
**목적**: 학습 세션 및 진도 관리  
**기존 자산**: `modules/quiz_handler.py` 일부 활용

```python
class QuizSessionManager:
    """학습 세션 전문 관리"""
    
    def __init__(self, user_id):
        self.user_id = user_id
        self.current_session = None
        
    def start_basic_learning(self, mode='continue'):
        """기본학습 세션 시작"""
        # mode: continue/restart/random
        
    def start_category_learning(self, category):
        """대분류학습 세션 시작"""
        
    def get_current_question(self):
        """현재 문제 반환"""
        
    def move_to_next_question(self):
        """다음 문제로 이동"""
        
    def move_to_previous_question(self):
        """이전 문제로 이동"""
        
    def save_session_progress(self):
        """세션 진도 저장"""
        # 30초마다 자동 저장
        
    def restore_session_progress(self):
        """세션 진도 복원"""
        # 브라우저 재시작 시 복원
```

### **Module 3: quiz_answer_processor.py (120줄)**
**목적**: 답안 처리 및 결과 관리  
**기존 자산**: `modules/quiz_handler.py` 답안 로직 활용

```python
class QuizAnswerProcessor:
    """답안 처리 전문"""
    
    def __init__(self):
        self.current_answer = None
        self.is_checked = False
        
    def select_answer(self, answer):
        """답안 선택"""
        self.current_answer = answer
        self.is_checked = False
        
    def check_answer(self, question, selected_answer):
        """정답 확인 및 결과 반환"""
        correct_answer = question.get('ANSWER')
        is_correct = selected_answer == correct_answer
        
        return {
            'isCorrect': is_correct,
            'selectedAnswer': selected_answer,
            'correctAnswer': correct_answer,
            'explanation': question.get('EXPLANATION', '')
        }
        
    def generate_answer_buttons(self, question):
        """문제 유형별 답안 버튼 생성"""
        # 진위형: O/X 버튼
        # 선택형: 1,2,3,4 버튼
        
    def highlight_correct_answer(self, question, result):
        """정답 하이라이트 표시"""
```

### **Module 4: quiz_ui_controller.py (200줄)**
**목적**: UI 업데이트 및 사용자 상호작용  
**신규 개발**: 기존 HTML 로직을 모듈로 분리

```python
class QuizUIController:
    """퀴즈 UI 전문 관리"""
    
    def __init__(self, mode='basic'):
        self.mode = mode
        self.ui_elements = self.get_ui_elements_by_mode(mode)
        
    def display_question(self, question, question_index, total_questions):
        """문제 화면 업데이트"""
        # 문제 텍스트, 코드, 유형, 분류 정보 표시
        
    def update_progress_indicator(self, current, total):
        """진도 표시 업데이트"""
        # "문제 X / 총 Y개"
        
    def show_answer_result(self, result):
        """답안 결과 표시"""
        # 정답: 초록색, 오답: 빨간색
        
    def enable_navigation_buttons(self, can_prev, can_next):
        """이전/다음 버튼 활성화 상태"""
        
    def show_loading_state(self):
        """로딩 상태 표시"""
        
    def show_error_message(self, message):
        """오류 메시지 표시"""
```

### **Module 5: quiz_routes.py (150줄 업데이트)**
**목적**: API 엔드포인트 정리 및 최적화  
**기존**: `routes/quiz_routes.py` 업데이트

```python
from services.quiz_data_service import QuizDataService
from services.quiz_session_manager import QuizSessionManager
from services.quiz_answer_processor import QuizAnswerProcessor

quiz_bp = Blueprint('quiz', __name__)

@quiz_bp.route('/api/quiz/start', methods=['POST'])
def start_quiz():
    """퀴즈 시작 API"""
    # quiz_session_manager 활용
    
@quiz_bp.route('/api/quiz/question/<int:index>')
def get_question(index):
    """특정 문제 조회 API"""
    # quiz_data_service 활용
    
@quiz_bp.route('/api/quiz/answer', methods=['POST']) 
def submit_answer():
    """답안 제출 API"""
    # quiz_answer_processor 활용
    
@quiz_bp.route('/api/quiz/progress')
def get_progress():
    """진도 조회 API"""
    # quiz_session_manager 활용
```

---

## 📅 **분할 개발 일정**

### **Day 1: 데이터 서비스 분리**
**작업**: `quiz_data_service.py` 생성
- `modules/data_converter.py` 로직 활용
- 789개 문제 로드 최적화
- 카테고리별 필터링 구현

### **Day 2: 세션 관리 분리**  
**작업**: `quiz_session_manager.py` 생성
- `modules/quiz_handler.py` 세션 로직 분리
- 진도 저장/복원 기능
- 모드별 세션 관리

### **Day 3: 답안 처리 분리**
**작업**: `quiz_answer_processor.py` 생성
- 정답 확인 로직 분리
- 답안 버튼 생성 로직
- 결과 표시 로직

### **Day 4: UI 컨트롤러 분리**
**작업**: `quiz_ui_controller.py` 생성
- 기존 HTML 내 JavaScript를 모듈로 분리
- 동적 UI 업데이트 로직
- 사용자 상호작용 처리

### **Day 5: 통합 및 테스트**
**작업**: 전체 모듈 통합
- `routes/quiz_routes.py` 업데이트
- 전체 플로우 테스트
- 시즌1 기능 100% 재현 확인

---

## ✅ **분할 개발 원칙 준수**

### **코드 라인 수 준수**
```
quiz_data_service.py      - 150줄 (200줄 이하 ✅)
quiz_session_manager.py   - 180줄 (200줄 이하 ✅)  
quiz_answer_processor.py  - 120줄 (200줄 이하 ✅)
quiz_ui_controller.py     - 200줄 (200줄 이하 ✅)
quiz_routes.py           - 150줄 (200줄 이하 ✅)
```

### **기존 자산 최대 활용**
```
✅ modules/quiz_handler.py (357줄) → 4개 모듈로 분할
✅ modules/data_converter.py (271줄) → quiz_data_service에 통합
✅ data/questions.json (789개) → 완전 활용
✅ 기존 HTML 구조 → quiz_ui_controller로 모듈화
```

### **독립성 및 재사용성**
```
✅ 각 모듈 독립적 기능
✅ 다른 앱에서도 재사용 가능
✅ 테스트 및 유지보수 용이
✅ 팀 협업 효율성 증대
```

---

## 🎯 **완료 후 기대 효과**

### **개발 효율성**
- ✅ **모듈별 개발**: 각자 전문 영역 집중
- ✅ **병렬 작업**: 여러 모듈 동시 개발 가능
- ✅ **빠른 디버깅**: 문제 발생 시 해당 모듈만 수정

### **코드 품질**
- ✅ **가독성**: 각 모듈의 명확한 역할
- ✅ **유지보수**: 기능별 독립적 수정
- ✅ **확장성**: 새로운 기능 추가 용이

### **팀 협업**
- ✅ **역할 분담**: 노팀장(로직), 서대리(UI), 조대표(검수)
- ✅ **진도 관리**: 모듈별 완료 상태 명확
- ✅ **품질 관리**: 200줄 원칙으로 리뷰 효율성

---

## 🚀 **즉시 실행 제안**

### **1단계: 현재 quiz_handler.py 분석**
```bash
# 기존 quiz_handler.py (357줄) 기능 분석
# - 데이터 로드: XX줄 → quiz_data_service.py
# - 세션 관리: XX줄 → quiz_session_manager.py  
# - 답안 처리: XX줄 → quiz_answer_processor.py
# - UI 업데이트: XX줄 → quiz_ui_controller.py
```

### **2단계: 점진적 분리 시작**
```
오늘: quiz_data_service.py 생성 및 테스트
내일: quiz_session_manager.py 생성 및 연동
...
```

### **3단계: 통합 검증**
```
기존 기능 100% 재현 확인
성능 최적화
조대표님 검수
```

---

## 📋 **조대표님 승인 요청**

### **접근 방식 승인**
- [ ] **문제풀이 우선 개발** (설정 완료 후 논리적 순서)
- [ ] **분할 개발 방식 적용** (200줄 원칙 준수)
- [ ] **기존 자산 최대 활용** (Week1 모듈들 분할)

### **일정 승인**  
- [ ] **5일 분할 개발** (모듈별 1일씩)
- [ ] **점진적 접근** (매일 하나씩 완성)
- [ ] **지속적 테스트** (분할 과정에서 기능 보존)

### **팀 역할 분담**
- [ ] **노팀장**: 핵심 로직 모듈 (data_service, session_manager)
- [ ] **서대리**: UI 및 통합 모듈 (ui_controller, routes)  
- [ ] **조대표님**: 일일 진도 체크 및 최종 검수

**조대표님 말씀대로 문제풀이 기능부터 분할 방식으로 진행하는 것이 가장 논리적이고 효율적입니다!**