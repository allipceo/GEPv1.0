# 077_통계기능업데이트계획서

## 📋 문서 정보
- **문서명**: AICU S4 통계기능 업데이트 계획서
- **작성일**: 2025년 8월 14일
- **작성자**: 서대리 (AI 개발팀)
- **프로젝트**: AICU S4 v2.1 통계기능 고도화
- **버전**: V1.0

---

## 🎯 1. 사용자 시나리오 분석

### 1.1 핵심 사용자 시나리오

#### **Day-1 시나리오**
1. **앱 시작 및 자동 등록**: 사용자 등록 없이 기본값으로 시작
2. **이어풀기 핵심 기능**: 정확한 진도 추적 (1번→10번→11번→21번)
3. **통합 통계**: 기본학습 + 대분류 학습 통합 카운트
4. **설정 기반 통계**: 등록일부터 모든 통계 시작

#### **Day-2 시나리오**
1. **일일/누적 통계 분리**: 금일 0개, 누적 20개 표시
2. **실시간 업데이트**: 문제 풀이 후 즉시 통계 반영
3. **카테고리별 독립 추적**: 각 학습 모드별 진도 관리

### 1.2 핵심 요구사항

#### **1.2.1 데이터 지속성**
- ✅ 프로그램 재시작 후 정보 유지
- ✅ 이어풀기 정보 지속적 보존
- ✅ 사용자 설정 정보 영구 저장

#### **1.2.2 자동 등록 시스템**
- ✅ 기본값으로 시작 (홍길동, 2025.08.01 등)
- ✅ 설정에서 실제 정보로 변경 가능
- ✅ 변경 후 영구 저장

#### **1.2.3 정확한 진도 추적**
- ✅ 시간별 정확한 다음 문제 번호
- ✅ 카테고리별 독립 진도 관리
- ✅ 통합 통계와 개별 통계 분리

---

## 📊 2. 현재 구현 상태 vs 요구사항 비교

### 2.1 현재 구현된 기능

#### **✅ 완료된 기능**
- LocalStorage 기반 진도 저장
- 기본 이어풀기 기능
- 실시간 통계 업데이트
- 데이터 검증 및 복구

#### **❌ 부족한 기능**
- 사용자 등록 시스템 연동
- 자동 기본값 설정
- 시간별 상세 로그
- 통합 통계 vs 개별 통계 분리
- 설정 기반 통계 시작점

### 2.2 핵심 차이점 분석

| 요구사항 | 현재 구현 | 차이점 | 우선순위 |
|----------|-----------|--------|----------|
| **자동 등록** | ❌ 없음 | 기본값 자동 설정 필요 | 🔴 높음 |
| **시간별 로그** | ❌ 없음 | 상세 로그 시스템 필요 | 🔴 높음 |
| **설정 연동** | ❌ 없음 | 사용자 설정 연동 필요 | 🟡 중간 |
| **통합 통계** | ⚠️ 부분적 | 대문 통합 통계 부족 | 🟡 중간 |
| **진도 정확성** | ✅ 구현됨 | 현재 상태 양호 | 🟢 낮음 |

---

## 🏗️ 3. 업데이트 계획

### 3.1 Phase 1: 데이터 구조 고도화

#### **3.1.1 statistics.json 파일 생성**
```json
{
  "user_info": {
    "name": "홍길동",
    "registration_date": "2025-08-01",
    "exam_name": "ACIU",
    "exam_date": "2025-09-13",
    "phone": "010-1234-5678",
    "is_registered": false
  },
  "progress_data": {
    "basic_learning": {
      "last_question": 20,
      "total_attempted": 20,
      "total_correct": 15,
      "today_attempted": 0,
      "today_correct": 0,
      "last_study_date": "2025-08-01"
    },
    "categories": {
      "해상보험": {
        "last_question": 20,
        "total_attempted": 20,
        "total_correct": 18,
        "today_attempted": 0,
        "today_correct": 0,
        "last_study_date": "2025-08-01"
      }
    }
  },
  "daily_logs": [
    {
      "date": "2025-08-01",
      "time": "11:00",
      "question_id": 1,
      "category": "basic_learning",
      "is_correct": true,
      "session_id": "session_001"
    }
  ],
  "statistics": {
    "total_questions_solved": 40,
    "total_correct_answers": 33,
    "overall_accuracy": 82.5,
    "study_days": 1,
    "current_streak": 1
  }
}
```

#### **3.1.2 새로운 데이터 관리자 클래스**
```javascript
class AdvancedProgressManager {
    constructor() {
        this.statisticsFile = 'statistics.json';
        this.userInfo = this.getDefaultUserInfo();
        this.progressData = this.getDefaultProgressData();
        this.dailyLogs = [];
        this.statistics = this.getDefaultStatistics();
    }
    
    // 자동 등록 시스템
    getDefaultUserInfo() {
        return {
            name: "홍길동",
            registration_date: new Date().toISOString().split('T')[0],
            exam_name: "ACIU",
            exam_date: "2025-09-13",
            phone: "010-1234-5678",
            is_registered: false
        };
    }
    
    // 시간별 로그 시스템
    logQuestionAttempt(questionId, category, isCorrect) {
        const log = {
            date: new Date().toISOString().split('T')[0],
            time: new Date().toLocaleTimeString(),
            question_id: questionId,
            category: category,
            is_correct: isCorrect,
            session_id: this.generateSessionId()
        };
        this.dailyLogs.push(log);
        this.updateStatistics();
        this.saveToFile();
    }
}
```

### 3.2 Phase 2: 사용자 등록 시스템

#### **3.2.1 자동 등록 기능**
- 앱 시작 시 기본값으로 자동 설정
- 설정 페이지에서 실제 정보 입력 가능
- 입력 후 영구 저장 및 통계 시작점 설정

#### **3.2.2 설정 페이지 업데이트**
```html
<!-- 설정 페이지 사용자 정보 섹션 -->
<div class="user-registration-section">
    <h3>사용자 정보</h3>
    <div class="current-info">
        <p>현재 등록 정보: <span id="current-user-name">홍길동</span></p>
        <p>등록일: <span id="current-registration-date">2025-08-01</span></p>
        <p>상태: <span id="registration-status">자동 등록</span></p>
    </div>
    
    <button onclick="editUserInfo()" class="edit-button">
        📝 실제 정보로 변경
    </button>
    
    <div id="user-edit-form" class="hidden">
        <input type="text" id="user-name" placeholder="이름">
        <input type="date" id="exam-date" placeholder="시험일">
        <input type="text" id="phone" placeholder="전화번호">
        <button onclick="saveUserInfo()">저장</button>
    </div>
</div>
```

### 3.3 Phase 3: 통계 시스템 고도화

#### **3.3.1 통합 통계 vs 개별 통계**
```javascript
class AdvancedStatsCalculator {
    // 대문 통합 통계
    calculateHomeStatistics() {
        const today = new Date().toISOString().split('T')[0];
        const todayLogs = this.dailyLogs.filter(log => log.date === today);
        
        return {
            total_today: todayLogs.length,
            correct_today: todayLogs.filter(log => log.is_correct).length,
            accuracy_today: this.calculateAccuracy(todayLogs),
            total_overall: this.statistics.total_questions_solved,
            correct_overall: this.statistics.total_correct_answers,
            accuracy_overall: this.statistics.overall_accuracy
        };
    }
    
    // 개별 학습 통계
    calculateCategoryStatistics(category) {
        const categoryLogs = this.dailyLogs.filter(log => log.category === category);
        const today = new Date().toISOString().split('T')[0];
        const todayCategoryLogs = categoryLogs.filter(log => log.date === today);
        
        return {
            today_attempted: todayCategoryLogs.length,
            today_correct: todayCategoryLogs.filter(log => log.is_correct).length,
            total_attempted: categoryLogs.length,
            total_correct: categoryLogs.filter(log => log.is_correct).length,
            last_question: this.progressData[category].last_question
        };
    }
}
```

#### **3.3.2 실시간 통계 업데이트**
```javascript
class RealTimeStatsUpdater {
    updateHomeStats() {
        const homeStats = this.statsCalculator.calculateHomeStatistics();
        
        document.getElementById('home-total-today').textContent = homeStats.total_today;
        document.getElementById('home-correct-today').textContent = homeStats.correct_today;
        document.getElementById('home-accuracy-today').textContent = homeStats.accuracy_today + '%';
        document.getElementById('home-total-overall').textContent = homeStats.total_overall;
    }
    
    updateCategoryStats(category) {
        const categoryStats = this.statsCalculator.calculateCategoryStatistics(category);
        
        document.getElementById(`${category}-today-attempted`).textContent = categoryStats.today_attempted;
        document.getElementById(`${category}-today-correct`).textContent = categoryStats.today_correct;
        document.getElementById(`${category}-total-attempted`).textContent = categoryStats.total_attempted;
        document.getElementById(`${category}-total-correct`).textContent = categoryStats.total_correct;
        document.getElementById(`${category}-next-question`).textContent = categoryStats.last_question + 1;
    }
}
```

### 3.4 Phase 4: UI/UX 개선

#### **3.4.1 대문 통계 박스 업데이트**
```html
<!-- 대문 통계 박스 -->
<div class="home-stats-container">
    <div class="today-stats">
        <h4>오늘 학습 현황</h4>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label">총 풀이</span>
                <span class="stat-value" id="home-total-today">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">정답</span>
                <span class="stat-value" id="home-correct-today">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">정답률</span>
                <span class="stat-value" id="home-accuracy-today">0%</span>
            </div>
        </div>
    </div>
    
    <div class="overall-stats">
        <h4>전체 학습 현황</h4>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label">총 풀이</span>
                <span class="stat-value" id="home-total-overall">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">정답</span>
                <span class="stat-value" id="home-correct-overall">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">정답률</span>
                <span class="stat-value" id="home-accuracy-overall">0%</span>
            </div>
        </div>
    </div>
</div>
```

#### **3.4.2 학습 페이지 통계 박스**
```html
<!-- 기본학습 통계 박스 -->
<div class="learning-stats-container">
    <div class="today-category-stats">
        <h4>오늘 기본학습</h4>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label">풀이</span>
                <span class="stat-value" id="basic-learning-today-attempted">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">정답</span>
                <span class="stat-value" id="basic-learning-today-correct">0</span>
            </div>
        </div>
    </div>
    
    <div class="overall-category-stats">
        <h4>전체 기본학습</h4>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label">총 풀이</span>
                <span class="stat-value" id="basic-learning-total-attempted">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">총 정답</span>
                <span class="stat-value" id="basic-learning-total-correct">0</span>
            </div>
        </div>
    </div>
    
    <div class="next-question-info">
        <h4>다음 문제</h4>
        <p>문제 번호: <span id="basic-learning-next-question">1</span></p>
    </div>
</div>
```

---

## 📁 4. 새로운 파일 구조

### 4.1 새로 생성할 파일

#### **4.1.1 데이터 파일**
- `static/data/statistics.json` - 통합 통계 데이터
- `static/data/user_settings.json` - 사용자 설정 데이터

#### **4.1.2 JavaScript 모듈**
- `static/js/advanced_progress_manager.js` - 고도화된 진도 관리
- `static/js/user_registration_manager.js` - 사용자 등록 관리
- `static/js/advanced_stats_calculator.js` - 고도화된 통계 계산
- `static/js/real_time_stats_updater.js` - 실시간 통계 업데이트
- `static/js/statistics_file_manager.js` - 파일 기반 데이터 관리

#### **4.1.3 HTML 템플릿**
- `templates/settings_advanced.html` - 고도화된 설정 페이지
- `templates/statistics_dashboard.html` - 통계 대시보드

### 4.2 수정할 파일

#### **4.2.1 기존 파일 업데이트**
- `routes/home_routes.py` - 대문 통합 통계 추가
- `templates/basic_learning.html` - 개별 통계 박스 업데이트
- `templates/large_category_learning.html` - 카테고리별 통계 추가
- `app_v2.1.py` - 새로운 라우트 추가

---

## 🗓️ 5. 개발 일정

### 5.1 Phase 1: 데이터 구조 고도화 (2일)
- **Day 1**: statistics.json 구조 설계 및 파일 관리자 구현
- **Day 2**: AdvancedProgressManager 클래스 구현 및 테스트

### 5.2 Phase 2: 사용자 등록 시스템 (2일)
- **Day 3**: 자동 등록 기능 및 기본값 설정
- **Day 4**: 설정 페이지 업데이트 및 사용자 정보 관리

### 5.3 Phase 3: 통계 시스템 고도화 (2일)
- **Day 5**: 통합 통계 vs 개별 통계 분리 구현
- **Day 6**: 실시간 통계 업데이트 시스템 구현

### 5.4 Phase 4: UI/UX 개선 (1일)
- **Day 7**: 대문 및 학습 페이지 통계 박스 업데이트

---

## 🎯 6. 핵심 구현 포인트

### 6.1 데이터 지속성 확보
```javascript
// 파일 기반 데이터 저장
class StatisticsFileManager {
    saveStatistics() {
        const data = {
            user_info: this.userInfo,
            progress_data: this.progressData,
            daily_logs: this.dailyLogs,
            statistics: this.statistics
        };
        
        localStorage.setItem('aicu_statistics', JSON.stringify(data));
        // 추가로 서버에 백업 (선택사항)
    }
    
    loadStatistics() {
        const savedData = localStorage.getItem('aicu_statistics');
        if (savedData) {
            const data = JSON.parse(savedData);
            this.userInfo = data.user_info;
            this.progressData = data.progress_data;
            this.dailyLogs = data.daily_logs;
            this.statistics = data.statistics;
        }
    }
}
```

### 6.2 정확한 진도 추적
```javascript
// 시간별 정확한 진도 관리
class PreciseProgressTracker {
    getNextQuestion(category) {
        const lastQuestion = this.progressData[category].last_question;
        return lastQuestion + 1;
    }
    
    updateProgress(category, questionId, isCorrect) {
        // 진도 업데이트
        this.progressData[category].last_question = questionId;
        this.progressData[category].total_attempted++;
        if (isCorrect) {
            this.progressData[category].total_correct++;
        }
        
        // 오늘 통계 업데이트
        const today = new Date().toISOString().split('T')[0];
        if (this.progressData[category].last_study_date !== today) {
            this.progressData[category].today_attempted = 0;
            this.progressData[category].today_correct = 0;
            this.progressData[category].last_study_date = today;
        }
        
        this.progressData[category].today_attempted++;
        if (isCorrect) {
            this.progressData[category].today_correct++;
        }
        
        // 로그 기록
        this.logQuestionAttempt(questionId, category, isCorrect);
    }
}
```

### 6.3 통합 통계 시스템
```javascript
// 대문 통합 통계 계산
class IntegratedStatisticsCalculator {
    calculateHomeStatistics() {
        const today = new Date().toISOString().split('T')[0];
        const todayLogs = this.dailyLogs.filter(log => log.date === today);
        
        const totalToday = todayLogs.length;
        const correctToday = todayLogs.filter(log => log.is_correct).length;
        const accuracyToday = totalToday > 0 ? (correctToday / totalToday * 100).toFixed(1) : 0;
        
        return {
            total_today: totalToday,
            correct_today: correctToday,
            accuracy_today: accuracyToday,
            total_overall: this.statistics.total_questions_solved,
            correct_overall: this.statistics.total_correct_answers,
            accuracy_overall: this.statistics.overall_accuracy
        };
    }
}
```

---

## 🚀 7. 예상 성과

### 7.1 사용자 경험 개선
- **정확한 이어풀기**: 시간에 관계없이 정확한 진도 추적
- **통합 통계**: 대문에서 전체 학습 현황 한눈에 확인
- **개별 통계**: 각 학습 모드별 상세 통계 제공
- **자동 등록**: 즉시 학습 시작 가능

### 7.2 데이터 안정성 향상
- **파일 기반 저장**: LocalStorage + 파일 백업
- **시간별 로그**: 상세한 학습 기록 보관
- **자동 복구**: 데이터 손상 시 자동 복구

### 7.3 확장성 확보
- **모듈화 설계**: 새로운 통계 기능 추가 용이
- **API 준비**: 향후 서버 연동 기반 마련
- **다중 사용자**: 사용자별 독립 데이터 관리

---

## 📋 8. 구현 우선순위

### 8.1 🔴 최우선 (Phase 1)
1. **statistics.json 파일 구조 설계**
2. **AdvancedProgressManager 구현**
3. **시간별 로그 시스템**

### 8.2 🟡 높음 (Phase 2)
1. **자동 등록 시스템**
2. **설정 페이지 업데이트**
3. **사용자 정보 관리**

### 8.3 🟡 중간 (Phase 3)
1. **통합 통계 vs 개별 통계 분리**
2. **실시간 통계 업데이트**
3. **대문 통계 박스 업데이트**

### 8.4 🟢 낮음 (Phase 4)
1. **UI/UX 개선**
2. **통계 대시보드**
3. **고급 통계 기능**

---

## 🎯 9. 결론

### 9.1 핵심 목표
**"사용자 시나리오에 완벽 부합하는 통계 시스템 구축"**

### 9.2 성공 기준
- ✅ 자동 등록으로 즉시 학습 시작
- ✅ 정확한 이어풀기 (시간 무관)
- ✅ 통합 통계와 개별 통계 분리
- ✅ 데이터 지속성 보장
- ✅ 실시간 통계 업데이트

### 9.3 예상 개발 기간
**총 7일** (Phase 1-4 순차 진행)

---

**📅 계획서 작성일**: 2025년 8월 14일  
**👤 작성자**: 서대리 (AI 개발팀)  
**📧 연락처**: 개발팀 내부  
**🏢 프로젝트**: AICU S4 v2.1 통계기능 고도화  

**🎯 핵심 목표**: **사용자 시나리오 완벽 구현!** 🚀
